# ChonCance 테스트 계획서

## 목차
1. [테스트 개요](#테스트-개요)
2. [테스트 환경](#테스트-환경)
3. [테스트 시나리오](#테스트-시나리오)
4. [테스트 체크리스트](#테스트-체크리스트)

---

## 테스트 개요

### 목적
ChonCance MVP의 핵심 기능이 정상적으로 동작하는지 검증하고, 사용자 경험을 최적화합니다.

### 테스트 범위
- 인증 및 권한 관리
- API 엔드포인트
- 페이지 렌더링 및 라우팅
- 데이터베이스 연동
- 에러 핸들링
- 성능 및 보안

---

## 테스트 환경

### 로컬 환경
- URL: http://localhost:3000
- Database: PostgreSQL (로컬)
- 인증: Clerk (테스트 모드)

### 프로덕션 환경
- URL: https://choncance-646626710380.asia-northeast3.run.app
- Database: Cloud SQL (GCP)
- 인증: Clerk (프로덕션)

---

## 테스트 시나리오

### 1. 인증 및 권한 테스트

#### 1.1 비로그인 사용자
**시나리오**: 로그인하지 않은 사용자가 서비스 이용

**테스트 케이스**:
- [ ] 홈페이지 접근 가능
- [ ] 숙소 탐색 페이지(/explore) 접근 가능
- [ ] 숙소 상세 페이지(/property/[id]) 접근 가능
- [ ] 로그인 페이지(/login) 접근 가능
- [ ] 회원가입 페이지(/signup) 접근 가능

**제한 사항**:
- [ ] 예약 페이지 접근 시 로그인 페이지로 리다이렉트
- [ ] 찜하기 기능 사용 시 로그인 페이지로 리다이렉트
- [ ] 리뷰 작성 시도 시 로그인 페이지로 리다이렉트
- [ ] 호스트 대시보드(/host/*) 접근 시 로그인 페이지로 리다이렉트
- [ ] 관리자 페이지(/admin) 접근 시 로그인 페이지로 리다이렉트

#### 1.2 일반 사용자 (GUEST)
**시나리오**: 로그인한 일반 사용자의 기능 접근

**테스트 케이스**:
- [ ] 숙소 검색 및 필터링
- [ ] 숙소 상세 정보 조회
- [ ] 찜하기 추가/제거
- [ ] 예약하기
- [ ] 예약 조회(/bookings)
- [ ] 예약 취소
- [ ] 리뷰 작성
- [ ] 알림 조회(/notifications)

**제한 사항**:
- [ ] 호스트 대시보드 접근 시 403 에러 또는 호스트 등록 페이지로 리다이렉트
- [ ] 관리자 페이지 접근 시 403 에러

#### 1.3 호스트 사용자 (HOST)
**시나리오**: 호스트 권한을 가진 사용자의 기능 접근

**테스트 케이스**:
- [ ] 모든 일반 사용자 기능 접근 가능
- [ ] 호스트 대시보드(/host/dashboard) 접근
- [ ] 숙소 관리(/host/properties) 접근
- [ ] 새 숙소 등록(/host/properties/new)
- [ ] 숙소 정보 수정(/host/properties/[id]/edit)
- [ ] 예약 관리(/host/bookings) 접근
- [ ] 예약 승인/거부
- [ ] 리뷰에 답글 작성
- [ ] 호스트 통계 조회

**제한 사항**:
- [ ] 관리자 페이지 접근 시 403 에러

#### 1.4 관리자 (ADMIN)
**시나리오**: 관리자 권한을 가진 사용자의 기능 접근

**테스트 케이스**:
- [ ] 모든 호스트 기능 접근 가능
- [ ] 관리자 대시보드(/admin) 접근
- [ ] 전체 통계 조회
- [ ] 모든 숙소 조회
- [ ] 모든 예약 조회
- [ ] 모든 회원 조회

---

### 2. API 엔드포인트 테스트

#### 2.1 태그 API
**엔드포인트**: `GET /api/tags`

**테스트 케이스**:
```bash
# 모든 태그 조회
curl http://localhost:3000/api/tags

# 카테고리별 태그 조회
curl http://localhost:3000/api/tags?category=VIEW
curl http://localhost:3000/api/tags?category=ACTIVITY
curl http://localhost:3000/api/tags?category=FACILITY
curl http://localhost:3000/api/tags?category=VIBE
```

**검증 항목**:
- [ ] 200 OK 응답
- [ ] 올바른 JSON 형식
- [ ] 16개의 태그 반환 (필터 없을 때)
- [ ] 카테고리별 올바른 태그 수 반환
- [ ] 각 태그의 필수 필드 존재 (id, name, category, description)

#### 2.2 숙소 API
**엔드포인트**: `GET /api/properties`

**테스트 케이스**:
```bash
# 모든 숙소 조회
curl http://localhost:3000/api/properties

# 태그 필터링
curl http://localhost:3000/api/properties?tags=산뷰맛집,아궁이체험

# 검색
curl http://localhost:3000/api/properties?search=제주

# 가격 필터링
curl http://localhost:3000/api/properties?minPrice=50000&maxPrice=150000

# 정렬
curl http://localhost:3000/api/properties?sort=price_asc
curl http://localhost:3000/api/properties?sort=price_desc
curl http://localhost:3000/api/properties?sort=rating_desc
```

**검증 항목**:
- [ ] 200 OK 응답
- [ ] 올바른 JSON 형식
- [ ] 필터링 정상 동작
- [ ] 정렬 정상 동작
- [ ] 페이지네이션 정상 동작 (limit, offset)

**엔드포인트**: `GET /api/properties/[id]`

**테스트 케이스**:
```bash
# 특정 숙소 상세 조회
curl http://localhost:3000/api/properties/[valid-id]

# 존재하지 않는 숙소
curl http://localhost:3000/api/properties/invalid-id
```

**검증 항목**:
- [ ] 200 OK 응답 (유효한 ID)
- [ ] 404 Not Found 응답 (무효한 ID)
- [ ] 숙소 상세 정보 포함 (이미지, 태그, 호스트 정보, 리뷰 등)

#### 2.3 예약 API
**엔드포인트**: `POST /api/bookings`

**테스트 케이스**:
```bash
# 예약 생성
curl -X POST http://localhost:3000/api/bookings \
  -H "Content-Type: application/json" \
  -d '{
    "propertyId": "valid-property-id",
    "checkIn": "2025-11-01",
    "checkOut": "2025-11-03",
    "guests": 2,
    "totalAmount": 200000
  }'
```

**검증 항목**:
- [ ] 인증 필요 (401 Unauthorized without auth)
- [ ] 201 Created 응답 (성공 시)
- [ ] 예약 ID 반환
- [ ] 데이터베이스에 예약 저장 확인

**엔드포인트**: `GET /api/bookings`

**검증 항목**:
- [ ] 인증된 사용자의 예약 목록 반환
- [ ] 상태별 필터링 가능 (PENDING, CONFIRMED, CANCELLED, etc.)

#### 2.4 찜하기 API
**엔드포인트**: `POST /api/wishlist/property/[propertyId]`

**테스트 케이스**:
```bash
# 찜하기 추가
curl -X POST http://localhost:3000/api/wishlist/property/[property-id]

# 찜하기 제거
curl -X DELETE http://localhost:3000/api/wishlist/property/[property-id]
```

**검증 항목**:
- [ ] 인증 필요
- [ ] 중복 추가 방지
- [ ] 성공 시 201 Created
- [ ] 제거 시 200 OK

#### 2.5 리뷰 API
**엔드포인트**: `POST /api/reviews`

**테스트 케이스**:
```bash
# 리뷰 작성
curl -X POST http://localhost:3000/api/reviews \
  -H "Content-Type: application/json" \
  -d '{
    "bookingId": "valid-booking-id",
    "propertyId": "valid-property-id",
    "rating": 5,
    "content": "정말 좋은 숙소였습니다!",
    "images": []
  }'
```

**검증 항목**:
- [ ] 인증 필요
- [ ] 완료된 예약에만 리뷰 작성 가능
- [ ] 중복 리뷰 방지
- [ ] 별점 1-5 범위 검증
- [ ] 내용 최소 길이 검증 (10자 이상)

**엔드포인트**: `POST /api/reviews/[reviewId]/reply`

**검증 항목**:
- [ ] 호스트만 답글 작성 가능
- [ ] 자신의 숙소 리뷰에만 답글 가능

#### 2.6 호스트 API
**엔드포인트**: `GET /api/host/properties`

**검증 항목**:
- [ ] 호스트만 접근 가능
- [ ] 자신의 숙소 목록만 반환

**엔드포인트**: `GET /api/host/bookings`

**검증 항목**:
- [ ] 호스트만 접근 가능
- [ ] 자신의 숙소에 대한 예약만 반환

**엔드포인트**: `PATCH /api/host/bookings/[id]/confirm`

**검증 항목**:
- [ ] 호스트만 접근 가능
- [ ] PENDING 상태의 예약만 승인 가능
- [ ] 승인 시 CONFIRMED 상태로 변경
- [ ] 알림 생성 확인

**엔드포인트**: `PATCH /api/host/bookings/[id]/reject`

**검증 항목**:
- [ ] 호스트만 접근 가능
- [ ] 거부 사유 필수
- [ ] REJECTED 상태로 변경
- [ ] 환불 처리 확인

#### 2.7 알림 API
**엔드포인트**: `GET /api/notifications`

**검증 항목**:
- [ ] 인증 필요
- [ ] 자신의 알림만 조회 가능
- [ ] 읽지 않은 알림 수 반환
- [ ] 페이지네이션 지원 (limit 파라미터)

**엔드포인트**: `PATCH /api/notifications/[id]`

**검증 항목**:
- [ ] 알림을 읽음으로 표시
- [ ] 자신의 알림만 수정 가능

---

### 3. 페이지 렌더링 및 라우팅 테스트

#### 3.1 공개 페이지
**테스트 케이스**:
- [ ] `/` - 홈페이지 렌더링
- [ ] `/explore` - 숙소 탐색 페이지
- [ ] `/property/[id]` - 숙소 상세 페이지
- [ ] `/login` - 로그인 페이지
- [ ] `/signup` - 회원가입 페이지

**검증 항목**:
- [ ] 200 OK 응답
- [ ] SEO 메타 태그 존재
- [ ] 이미지 최적화 (WebP/AVIF)
- [ ] 반응형 디자인 (모바일/태블릿/데스크톱)
- [ ] 로딩 시간 3초 이내

#### 3.2 인증 필요 페이지
**테스트 케이스**:
- [ ] `/bookings` - 예약 목록
- [ ] `/bookings/[id]` - 예약 상세
- [ ] `/notifications` - 알림
- [ ] `/wishlist` - 찜 목록

**검증 항목**:
- [ ] 비로그인 시 /login으로 리다이렉트
- [ ] 로그인 후 원래 페이지로 리다이렉트

#### 3.3 호스트 페이지
**테스트 케이스**:
- [ ] `/host/dashboard` - 호스트 대시보드
- [ ] `/host/properties` - 숙소 관리
- [ ] `/host/properties/new` - 새 숙소 등록
- [ ] `/host/properties/[id]/edit` - 숙소 수정
- [ ] `/host/bookings` - 예약 관리

**검증 항목**:
- [ ] 호스트가 아닌 경우 접근 제한
- [ ] 통계 데이터 정상 표시
- [ ] 폼 유효성 검사 작동

#### 3.4 관리자 페이지
**테스트 케이스**:
- [ ] `/admin` - 관리자 대시보드

**검증 항목**:
- [ ] 관리자가 아닌 경우 접근 제한
- [ ] 전체 통계 정상 표시

---

### 4. 데이터베이스 연동 테스트

#### 4.1 Prisma 클라이언트
**테스트 케이스**:
```bash
# Prisma 스튜디오 실행
npx prisma studio
```

**검증 항목**:
- [ ] 모든 모델 정상 조회
- [ ] 관계(relation) 정상 동작
- [ ] 데이터 CRUD 정상 동작

#### 4.2 데이터 무결성
**검증 항목**:
- [ ] 외래 키 제약조건 작동
- [ ] 유니크 제약조건 작동
- [ ] 필수 필드 검증
- [ ] 기본값 설정 확인

#### 4.3 트랜잭션
**테스트 시나리오**:
- [ ] 예약 생성 시 결제 정보도 함께 생성 (트랜잭션)
- [ ] 예약 취소 시 환불 처리 (트랜잭션)
- [ ] 에러 발생 시 롤백 확인

---

### 5. 에러 핸들링 테스트

#### 5.1 클라이언트 에러 (4xx)
**테스트 케이스**:
- [ ] 400 Bad Request - 잘못된 요청 데이터
- [ ] 401 Unauthorized - 인증 필요
- [ ] 403 Forbidden - 권한 부족
- [ ] 404 Not Found - 존재하지 않는 리소스
- [ ] 409 Conflict - 중복 데이터

**검증 항목**:
- [ ] 적절한 에러 메시지 반환
- [ ] 한글 에러 메시지
- [ ] 에러 코드 일관성

#### 5.2 서버 에러 (5xx)
**테스트 케이스**:
- [ ] 데이터베이스 연결 실패
- [ ] 외부 API 호출 실패 (Clerk, Toss Payments)
- [ ] 메모리 부족
- [ ] 타임아웃

**검증 항목**:
- [ ] 500 Internal Server Error 반환
- [ ] 에러 로그 기록
- [ ] 사용자에게 친절한 에러 메시지
- [ ] 민감한 정보 노출 방지

#### 5.3 네트워크 에러
**테스트 시나리오**:
- [ ] 인터넷 연결 끊김 시뮬레이션
- [ ] 느린 네트워크 시뮬레이션
- [ ] API 타임아웃

**검증 항목**:
- [ ] 로딩 인디케이터 표시
- [ ] 재시도 옵션 제공
- [ ] 오프라인 상태 안내

---

### 6. 성능 테스트

#### 6.1 페이지 로드 성능
**측정 도구**: Lighthouse

**목표**:
- [ ] Performance Score ≥ 90
- [ ] First Contentful Paint (FCP) ≤ 1.5s
- [ ] Largest Contentful Paint (LCP) ≤ 2.5s
- [ ] Time to Interactive (TTI) ≤ 3.5s
- [ ] Cumulative Layout Shift (CLS) ≤ 0.1

#### 6.2 API 응답 시간
**목표**:
- [ ] GET 요청: ≤ 200ms
- [ ] POST/PUT/PATCH 요청: ≤ 500ms
- [ ] 복잡한 쿼리 (통계, 집계): ≤ 1000ms

#### 6.3 데이터베이스 쿼리 최적화
**검증 항목**:
- [ ] N+1 쿼리 문제 확인 및 해결
- [ ] 인덱스 활용 확인
- [ ] 쿼리 실행 계획 분석

---

### 7. 보안 테스트

#### 7.1 인증 보안
**테스트 케이스**:
- [ ] JWT 토큰 검증
- [ ] 세션 만료 처리
- [ ] CSRF 토큰 검증
- [ ] 브루트 포스 공격 방어

#### 7.2 권한 검증
**테스트 케이스**:
- [ ] 수직 권한 상승 방어 (일반 사용자 → 관리자)
- [ ] 수평 권한 상승 방어 (다른 사용자의 데이터 접근)
- [ ] API 엔드포인트 권한 검사

#### 7.3 입력 검증
**테스트 케이스**:
- [ ] XSS (Cross-Site Scripting) 방어
- [ ] SQL Injection 방어 (Prisma ORM 사용)
- [ ] 파일 업로드 검증 (이미지 타입, 크기)
- [ ] HTML/JavaScript 이스케이핑

#### 7.4 민감 정보 보호
**검증 항목**:
- [ ] 환경 변수로 비밀 키 관리
- [ ] API 응답에서 비밀번호 제외
- [ ] 에러 메시지에서 스택 트레이스 제외 (프로덕션)
- [ ] HTTPS 강제 (프로덕션)

---

### 8. 사용자 시나리오 테스트

#### 8.1 게스트 예약 플로우
**시나리오**: 처음 방문한 사용자가 숙소를 검색하고 예약

**단계**:
1. [ ] 홈페이지 접속
2. [ ] "숙소 둘러보기" 클릭
3. [ ] 태그 필터로 "산뷰맛집" 선택
4. [ ] 마음에 드는 숙소 클릭
5. [ ] 상세 정보 확인 (사진, 설명, 리뷰)
6. [ ] "찜하기" 클릭 → 로그인 페이지로 이동
7. [ ] Clerk로 회원가입 및 로그인
8. [ ] 다시 숙소 상세 페이지로 돌아옴
9. [ ] "찜하기" 성공
10. [ ] "예약하기" 클릭
11. [ ] 체크인/체크아웃 날짜 선택
12. [ ] 게스트 수 선택
13. [ ] 총 금액 확인
14. [ ] "예약 요청" 클릭
15. [ ] 예약 완료 페이지 확인
16. [ ] "내 예약" 페이지에서 예약 확인

**검증 항목**:
- [ ] 전체 플로우 3분 이내 완료 가능
- [ ] 모든 단계에서 명확한 안내
- [ ] 에러 없이 완료

#### 8.2 호스트 숙소 등록 플로우
**시나리오**: 새로운 호스트가 숙소를 등록

**단계**:
1. [ ] "호스트 되기" 클릭
2. [ ] 호스트 등록 정보 입력 (사업자 번호, 연락처)
3. [ ] 승인 대기 (즉시 또는 관리자 승인)
4. [ ] 호스트 대시보드 접근
5. [ ] "새 숙소 등록" 클릭
6. [ ] 기본 정보 입력 (이름, 설명, 주소)
7. [ ] 이미지 업로드 (5장)
8. [ ] 가격 설정
9. [ ] 편의시설 선택
10. [ ] 태그 선택
11. [ ] 숙소 등록 완료
12. [ ] 숙소 목록에서 확인

**검증 항목**:
- [ ] 폼 유효성 검사 작동
- [ ] 이미지 업로드 성공
- [ ] 데이터베이스에 저장 확인

#### 8.3 리뷰 작성 및 호스트 답글 플로우
**시나리오**: 게스트가 리뷰를 작성하고 호스트가 답글

**단계**:
1. [ ] 게스트: 완료된 예약에서 "리뷰 작성" 클릭
2. [ ] 별점 5점 선택
3. [ ] 리뷰 내용 작성 (최소 10자)
4. [ ] 사진 업로드 (선택)
5. [ ] "리뷰 등록" 클릭
6. [ ] 리뷰 등록 확인
7. [ ] 호스트: 알림 수신
8. [ ] 호스트: 리뷰 확인
9. [ ] 호스트: "답글 작성" 클릭
10. [ ] 답글 내용 작성
11. [ ] "답글 등록" 클릭
12. [ ] 게스트: 알림 수신
13. [ ] 숙소 상세 페이지에서 리뷰와 답글 확인

**검증 항목**:
- [ ] 알림 정상 발송
- [ ] 리뷰와 답글 정상 표시
- [ ] 평균 별점 업데이트

---

## 테스트 실행 가이드

### 자동화 테스트 실행

```bash
# E2E 테스트 (Playwright)
npm run test:e2e

# 특정 브라우저에서만 실행
npx playwright test --project=chromium
npx playwright test --project=firefox
npx playwright test --project=webkit

# UI 모드로 실행
npx playwright test --ui

# 헤드풀 모드 (브라우저 표시)
npx playwright test --headed

# 디버그 모드
npx playwright test --debug
```

### 수동 테스트 체크리스트

#### 로컬 환경 테스트
1. [ ] `npm run dev` 실행
2. [ ] http://localhost:3000 접속
3. [ ] 브라우저 개발자 도구 열기
4. [ ] Console 에러 확인
5. [ ] Network 탭에서 API 응답 확인
6. [ ] 각 테스트 시나리오 실행

#### 프로덕션 환경 테스트
1. [ ] 배포 URL 접속
2. [ ] 동일한 테스트 시나리오 반복
3. [ ] 성능 측정 (Lighthouse)
4. [ ] 모바일 기기에서 테스트
5. [ ] 다양한 브라우저에서 테스트 (Chrome, Firefox, Safari, Edge)

---

## 버그 리포트 템플릿

발견된 버그는 다음 형식으로 기록:

```markdown
### 버그 제목
[간단한 설명]

**환경**:
- 브라우저: Chrome 120.0
- OS: macOS 14.0
- 환경: 로컬 / 프로덕션

**재현 단계**:
1.
2.
3.

**예상 동작**:
[어떻게 동작해야 하는지]

**실제 동작**:
[실제로 어떻게 동작하는지]

**스크린샷**:
[가능하면 첨부]

**에러 메시지**:
```
[콘솔 에러 메시지]
```

**우선순위**: Critical / High / Medium / Low
```

---

## 테스트 결과 요약

테스트 완료 후 아래 표를 작성:

| 카테고리 | 총 테스트 | 통과 | 실패 | 보류 | 통과율 |
|---------|---------|------|------|------|--------|
| 인증 및 권한 | 20 | - | - | - | -% |
| API 엔드포인트 | 30 | - | - | - | -% |
| 페이지 렌더링 | 15 | - | - | - | -% |
| 데이터베이스 | 10 | - | - | - | -% |
| 에러 핸들링 | 10 | - | - | - | -% |
| 성능 | 5 | - | - | - | -% |
| 보안 | 10 | - | - | - | -% |
| 사용자 시나리오 | 3 | - | - | - | -% |
| **전체** | **103** | **-** | **-** | **-** | **-%** |

---

## 다음 단계

1. [ ] 모든 Critical 버그 수정
2. [ ] High 우선순위 버그 수정
3. [ ] 성능 최적화
4. [ ] 보안 강화
5. [ ] 사용자 피드백 수집 및 반영
