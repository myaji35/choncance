# Story 3.3: Property Edit and Delete

## Status
Ready for Implementation

## Story
**As a** host with registered properties,
**I want** to edit or delete my property listings,
**so that** I can keep information up-to-date and remove listings I no longer want to offer.

## Acceptance Criteria
1. Host can access edit page from dashboard via "편집" button
2. Edit page pre-populates all fields with existing property data
3. Edit form uses the same 8-step structure as registration (reuse components)
4. Changes require admin re-approval if major fields are modified (photos, location, pricing)
5. Minor changes (story, inconveniences) do not require re-approval
6. Delete button is available on property detail page (host view only)
7. Delete confirmation modal warns if there are upcoming bookings
8. Cannot delete property with active/upcoming bookings (show error message)
9. Successfully deleted properties are soft-deleted (status = DELETED)
10. All operations display success/error toast notifications in Korean

## Tasks / Subtasks

- [ ] **Task 1**: Create edit property route (AC: 1, 2)
  - [ ] Create `src/app/host/properties/[id]/edit/page.tsx`
  - [ ] Fetch existing property data by ID
  - [ ] Pre-populate form with existing values
  - [ ] Reuse Step components from 3.2
  - [ ] Handle loading and error states

- [ ] **Task 2**: Implement edit logic and re-approval flow (AC: 3, 4, 5)
  - [ ] Create Server Action: `updateProperty(id, data, requiresReapproval)`
  - [ ] Determine if changes require re-approval (photos, location, pricing)
  - [ ] Update property status to PENDING if re-approval needed
  - [ ] Update property status to APPROVED if minor changes only
  - [ ] Show notification about re-approval if applicable

- [ ] **Task 3**: Implement delete functionality (AC: 6, 7, 8, 9)
  - [ ] Add "삭제" button to property management page
  - [ ] Create ConfirmDeleteModal component
  - [ ] Check for upcoming bookings before allowing delete
  - [ ] Display warning: "예정된 예약이 X건 있습니다. 삭제할 수 없습니다."
  - [ ] Soft delete: set status = DELETED instead of removing from DB
  - [ ] Create Server Action: `deleteProperty(id)`

- [ ] **Task 4**: Testing (AC: 10)
  - [ ] Test edit flow with all field types
  - [ ] Verify re-approval logic works correctly
  - [ ] Test delete with and without bookings
  - [ ] Verify toast notifications display
  - [ ] Test responsive layout
  - [ ] Run lint and fix issues

## Dev Notes

### Database Update
```typescript
// Major changes require re-approval
const majorFields = ['images', 'location', 'weekdayPrice', 'weekendPrice'];
const requiresReapproval = Object.keys(changes).some(key => majorFields.includes(key));

await prisma.property.update({
  where: { id },
  data: {
    ...changes,
    status: requiresReapproval ? 'PENDING' : existing.status
  }
});
```

### Korean Messages
- "숙소 정보가 수정되었습니다"
- "주요 정보가 변경되어 재승인이 필요합니다"
- "정말 삭제하시겠습니까?"
- "예정된 예약이 있어 삭제할 수 없습니다"

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-27 | 1.0 | Initial story for edit/delete | John (PM) |

## Priority
P0

## Story Points
3

## Epic
Epic 3: Host and Property Management
