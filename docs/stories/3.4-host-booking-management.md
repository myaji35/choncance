# Story 3.4: Host Booking Management

## Status
Ready for Implementation

## Story
**As a** host with active property listings,
**I want** to view and manage guest bookings for my properties,
**so that** I can prepare for guest arrivals and provide excellent service.

## Acceptance Criteria
1. Host can access booking management from dashboard or property detail page
2. Booking list shows: booking date, guest name (masked: 홍*동), check-in/out dates, guest count, total amount
3. Bookings are filterable by status: upcoming, in-progress, completed, cancelled
4. Bookings are sorted chronologically (nearest first)
5. Click on booking opens detailed view with full information
6. Detail view shows: unmasked guest name, phone number, special requests, payment status
7. Host can cancel a booking with reason input (triggers refund flow)
8. Cancellation by host requires confirmation modal with policy warning
9. After cancellation, guest and admin receive email notification
10. All UI text in Korean with polite formal language

## Tasks / Subtasks

- [ ] **Task 1**: Create booking list page (AC: 1, 2, 3, 4)
  - [ ] Create `src/app/host/bookings/page.tsx`
  - [ ] Fetch bookings for host's properties
  - [ ] Implement status filter tabs: 예정, 진행중, 완료, 취소됨
  - [ ] Display booking cards with masked guest names
  - [ ] Sort by check-in date ascending

- [ ] **Task 2**: Create booking detail view (AC: 5, 6)
  - [ ] Create `src/app/host/bookings/[id]/page.tsx`
  - [ ] Display full booking information
  - [ ] Show unmasked guest details (name, phone)
  - [ ] Show special requests and notes
  - [ ] Display payment status and amount breakdown

- [ ] **Task 3**: Implement host cancellation (AC: 7, 8, 9)
  - [ ] Add "예약 취소" button to detail view
  - [ ] Create CancelBookingModal component
  - [ ] Input field for cancellation reason (required)
  - [ ] Show refund policy warning
  - [ ] Create Server Action: `hostCancelBooking(bookingId, reason)`
  - [ ] Update booking status to CANCELLED_BY_HOST
  - [ ] Trigger refund via payment API
  - [ ] Send email notifications to guest and admin

- [ ] **Task 4**: Testing (AC: 10)
  - [ ] Test booking list filtering
  - [ ] Verify detail view shows correct data
  - [ ] Test cancellation flow end-to-end
  - [ ] Verify email notifications are sent
  - [ ] Test responsive layout
  - [ ] Verify Korean text rendering

## Dev Notes

### Database Query
```typescript
const bookings = await prisma.booking.findMany({
  where: {
    property: { hostId: userId },
    status: { in: ['CONFIRMED', 'CHECKED_IN'] }
  },
  include: {
    property: { select: { name: true, images: true } },
    guest: { select: { name: true, email: true, phone: true } }
  },
  orderBy: { checkIn: 'asc' }
});
```

### Korean Labels
- "예약 관리", "예정된 예약", "진행중", "완료", "취소됨"
- "게스트 정보", "특이사항", "결제 상태"
- "예약을 취소하시겠습니까?", "취소 사유"

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-27 | 1.0 | Initial story for booking management | John (PM) |

## Priority
P0

## Story Points
5

## Epic
Epic 3: Host and Property Management
