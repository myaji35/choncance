# Story 3.1: Host Dashboard

## Status
Ready for Implementation

## Story
**As a** registered host on ChonCance,
**I want** to view and manage my properties and bookings from a centralized dashboard,
**so that** I can efficiently monitor my business and provide excellent service to guests.

## Acceptance Criteria
1. The `/host/dashboard` page displays an overview of the host's account status
2. Dashboard shows a list of all registered properties with their status (pending, approved, rejected)
3. Dashboard displays upcoming bookings in chronological order
4. Dashboard shows revenue summary for the current month
5. Each property card shows: thumbnail image, property name, status badge, and quick action buttons
6. Booking cards display: guest name (masked), check-in/out dates, property name, and booking status
7. Revenue summary shows: total bookings, total revenue, pending payouts
8. All UI text is in Korean (ko)
9. The dashboard is fully responsive and follows the minimalist aesthetic
10. Only accessible to users with `role: HOST` (redirect guests to `/` with error message)

## Tasks / Subtasks

- [ ] **Task 1**: Create host dashboard route and authentication guard (AC: 10)
  - [ ] Create `src/app/host/dashboard/page.tsx` with role check
  - [ ] Add middleware protection for `/host/*` routes
  - [ ] Redirect non-hosts to landing page with toast message
  - [ ] Set up ServerComponent for initial data fetching

- [ ] **Task 2**: Create HostPropertyCard component (AC: 5)
  - [ ] Create `src/components/host/host-property-card.tsx`
  - [ ] Display property thumbnail using next/image
  - [ ] Show property name, location, and status badge
  - [ ] Add quick action buttons: Edit, View Stats, Manage Bookings
  - [ ] Style with shadcn/ui Card component
  - [ ] Add status badge colors: pending (yellow), approved (green), rejected (red)

- [ ] **Task 3**: Create BookingOverview component (AC: 6)
  - [ ] Create `src/components/host/booking-overview.tsx`
  - [ ] Display upcoming bookings in chronological order
  - [ ] Show guest name with masking (홍*동)
  - [ ] Display check-in/out dates, property name, and total amount
  - [ ] Add booking status badge: confirmed, checked-in, completed, cancelled
  - [ ] Link to detailed booking management page

- [ ] **Task 4**: Create RevenueSum mary component (AC: 7)
  - [ ] Create `src/components/host/revenue-summary.tsx`
  - [ ] Display total bookings count for current month
  - [ ] Show total revenue (숙박비 + 경험비)
  - [ ] Show pending payouts (결제 완료 but 정산 전)
  - [ ] Add date range selector for filtering
  - [ ] Style with Card component and use Charts library for visualization (optional MVP feature)

- [ ] **Task 5**: Integrate dashboard page with backend data (AC: 1, 2, 3, 4)
  - [ ] Create API endpoint: `GET /api/host/dashboard` (Server Action)
  - [ ] Fetch host's properties from database
  - [ ] Fetch upcoming bookings (next 30 days)
  - [ ] Calculate monthly revenue summary
  - [ ] Handle loading states with Skeleton components
  - [ ] Handle empty states (no properties, no bookings)

- [ ] **Task 6**: Testing and Polish (AC: 8, 9)
  - [ ] Verify role-based access control
  - [ ] Test responsive layout on mobile/tablet/desktop
  - [ ] Verify all Korean text displays correctly
  - [ ] Test data loading and error handling
  - [ ] Run `npm run lint` and fix issues
  - [ ] Verify minimalist design aesthetic

## Dev Notes

### Source Tree Information
[Source: docs/architecture/source-tree.md]

**Component Structure:**
- Create new directory: `src/components/host/` for host-specific components
- New route: `src/app/host/dashboard/page.tsx`
- Server Actions: `src/app/actions/host-actions.ts` (new file)

**File Locations:**
- Dashboard page: `src/app/host/dashboard/page.tsx` (new)
- HostPropertyCard: `src/components/host/host-property-card.tsx` (new)
- BookingOverview: `src/components/host/booking-overview.tsx` (new)
- RevenueSummary: `src/components/host/revenue-summary.tsx` (new)
- Host actions: `src/app/actions/host-actions.ts` (new)

### Tech Stack Requirements
[Source: docs/architecture/tech-stack.md]

**Framework:**
- Next.js 14 App Router with Server Components
- Use Server Actions for data fetching
- Client Components only for interactive elements (buttons, links)

**Authentication:**
- Clerk authentication with role-based access
- Check `user.publicMetadata.role === 'HOST'`
- Redirect with toast notification if not authorized

**Styling:**
- Tailwind CSS utility classes
- shadcn/ui Card, Badge, Button components
- CSS variables for consistent theming

### Coding Standards
[Source: docs/architecture/coding-standards.md]

**Role-Based Access Control:**
```typescript
import { auth } from '@clerk/nextjs/server';
import { redirect } from 'next/navigation';

export default async function HostDashboard() {
  const { userId } = await auth();
  const user = await currentUser();

  if (!user || user.publicMetadata.role !== 'HOST') {
    redirect('/?error=unauthorized');
  }

  // ... dashboard code
}
```

**Korean Language:**
- "호스트 대시보드"
- "내 숙소"
- "예정된 예약"
- "월 수익 요약"
- "총 예약", "총 수익", "정산 대기"

### Database Schema
[Source: PRD.md Section 6]

**Required Models:**
- Property (id, host_id, name, status, images, location)
- Booking (id, property_id, guest_id, check_in, check_out, status, total_amount)
- User (id, role, name, email)

**Queries:**
```typescript
// Fetch host properties
const properties = await prisma.property.findMany({
  where: { hostId: user.id },
  select: {
    id: true,
    name: true,
    status: true,
    images: true,
    location: true,
    _count: { select: { bookings: true } }
  }
});

// Fetch upcoming bookings
const bookings = await prisma.booking.findMany({
  where: {
    property: { hostId: user.id },
    checkIn: { gte: new Date() }
  },
  include: {
    property: { select: { name: true } },
    guest: { select: { name: true } }
  },
  orderBy: { checkIn: 'asc' },
  take: 10
});

// Calculate monthly revenue
const revenue = await prisma.booking.aggregate({
  where: {
    property: { hostId: user.id },
    status: 'COMPLETED',
    checkOut: {
      gte: startOfMonth(new Date()),
      lte: endOfMonth(new Date())
    }
  },
  _sum: { totalAmount: true },
  _count: true
});
```

### Empty States
- No properties: "아직 등록된 숙소가 없습니다" + CTA button "첫 숙소 등록하기"
- No bookings: "예정된 예약이 없습니다"
- Zero revenue: "이번 달 수익이 아직 없습니다"

### Testing
**Manual Testing Required:**
- Login as host user and verify dashboard loads
- Login as guest user and verify redirect to home
- Verify property list displays correctly
- Verify booking overview shows upcoming reservations
- Verify revenue summary calculates correctly
- Test responsive layout on different devices
- Verify Korean text rendering

**Future E2E Tests:**
- Playwright test for role-based access control
- Test dashboard data loading and display

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-27 | 1.0 | Initial story creation for Epic 3: Host Dashboard | John (PM) |

## Dependencies
- Epic 1: User Authentication (US-1.4 Host Account Registration) - **COMPLETED**
- Database schema for Property and Booking models
- Clerk authentication with role metadata

## Priority
P0 (Critical - Required for host onboarding)

## Story Points
5

## Epic
Epic 3: Host and Property Management
