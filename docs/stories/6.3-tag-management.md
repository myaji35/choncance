# Story 6.3: Tag Management (CRUD)

## Status
Ready for Implementation

## Story
**As an** admin,
**I want** to manage theme tags (create, edit, delete),
**so that** I can maintain a relevant and organized tag system for property discovery.

## Acceptance Criteria
1. Admin dashboard has "태그 관리" section
2. Displays list of all existing tags with: name, icon, usage count (# of properties)
3. "새 태그 추가" button opens creation form
4. Tag form fields: name (required, unique), emoji/icon, description
5. Tag name must start with # (e.g., #논뷰맛집)
6. Can edit existing tags (name, icon, description)
7. Can delete tags with confirmation modal
8. Cannot delete tag if properties are using it (show error with count)
9. Deleted tags removed from all associations (if forced delete implemented in future)
10. All CRUD operations show success/error toast in Korean

## Tasks
- [ ] Create admin route: `src/app/admin/tags/page.tsx`
- [ ] List all tags with usage statistics
- [ ] Create TagCard component showing name, icon, count
- [ ] Add "새 태그 추가" button
- [ ] Create TagFormModal for create/edit
- [ ] Form validation: name required, unique, starts with #
- [ ] Create Server Actions: createTag, updateTag, deleteTag
- [ ] Check tag usage before delete
- [ ] Show error if tag is in use: "X개 숙소가 사용중인 태그는 삭제할 수 없습니다"
- [ ] Implement success/error toast notifications
- [ ] Testing: create, edit, delete, validation, usage check

## Dev Notes
**Database Model:**
```prisma
model Tag {
  id          String   @id @default(cuid())
  name        String   @unique // e.g., "#논뷰맛집"
  icon        String?  // emoji or icon identifier
  description String?
  createdAt   DateTime @default(now())

  properties  Property[] // many-to-many relation
}
```

**Tag Validation:**
```typescript
const tagSchema = z.object({
  name: z.string()
    .min(2, '태그명은 최소 2자 이상이어야 합니다')
    .max(20, '태그명은 최대 20자까지 가능합니다')
    .regex(/^#/, '태그명은 #으로 시작해야 합니다')
    .regex(/^[#가-힣a-zA-Z0-9]+$/, '태그명은 한글, 영문, 숫자만 사용 가능합니다'),
  icon: z.string().optional(),
  description: z.string().max(100).optional()
});
```

**Delete Check:**
```typescript
async function deleteTag(tagId: string) {
  const tagWithCount = await prisma.tag.findUnique({
    where: { id: tagId },
    include: {
      _count: { select: { properties: true } }
    }
  });

  if (tagWithCount._count.properties > 0) {
    throw new Error(`${tagWithCount._count.properties}개 숙소가 사용중인 태그는 삭제할 수 없습니다`);
  }

  await prisma.tag.delete({ where: { id: tagId } });
}
```

**Initial Tags (Seed Data):**
- #논뷰맛집 🌾
- #불멍과별멍 🔥
- #반려동물동반 🐕
- #아궁이체험 🪵
- #계곡앞 💧
- #전통가옥 🏠
- #농사체험 🌱
- #눈꽃여행 ❄️

**Korean Labels:** "태그 관리", "새 태그 추가", "태그명", "사용 중인 숙소"

## Change Log
| Date | Version | Author |
|------|---------|--------|
| 2025-10-27 | 1.0 | John (PM) |

## Priority: P1 (High) | Story Points: 3 | Epic: Admin Features
