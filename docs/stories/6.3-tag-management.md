# Story 6.3: Tag Management (CRUD)

## Status
Ready for Implementation

## Story
**As an** admin,
**I want** to manage theme tags (create, edit, delete),
**so that** I can maintain a relevant and organized tag system for property discovery.

## Acceptance Criteria
1. Admin dashboard has "íƒœê·¸ ê´€ë¦¬" section
2. Displays list of all existing tags with: name, icon, usage count (# of properties)
3. "ìƒˆ íƒœê·¸ ì¶”ê°€" button opens creation form
4. Tag form fields: name (required, unique), emoji/icon, description
5. Tag name must start with # (e.g., #ë…¼ë·°ë§›ì§‘)
6. Can edit existing tags (name, icon, description)
7. Can delete tags with confirmation modal
8. Cannot delete tag if properties are using it (show error with count)
9. Deleted tags removed from all associations (if forced delete implemented in future)
10. All CRUD operations show success/error toast in Korean

## Tasks
- [ ] Create admin route: `src/app/admin/tags/page.tsx`
- [ ] List all tags with usage statistics
- [ ] Create TagCard component showing name, icon, count
- [ ] Add "ìƒˆ íƒœê·¸ ì¶”ê°€" button
- [ ] Create TagFormModal for create/edit
- [ ] Form validation: name required, unique, starts with #
- [ ] Create Server Actions: createTag, updateTag, deleteTag
- [ ] Check tag usage before delete
- [ ] Show error if tag is in use: "Xê°œ ìˆ™ì†Œê°€ ì‚¬ìš©ì¤‘ì¸ íƒœê·¸ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
- [ ] Implement success/error toast notifications
- [ ] Testing: create, edit, delete, validation, usage check

## Dev Notes
**Database Model:**
```prisma
model Tag {
  id          String   @id @default(cuid())
  name        String   @unique // e.g., "#ë…¼ë·°ë§›ì§‘"
  icon        String?  // emoji or icon identifier
  description String?
  createdAt   DateTime @default(now())

  properties  Property[] // many-to-many relation
}
```

**Tag Validation:**
```typescript
const tagSchema = z.object({
  name: z.string()
    .min(2, 'íƒœê·¸ëª…ì€ ìµœì†Œ 2ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤')
    .max(20, 'íƒœê·¸ëª…ì€ ìµœëŒ€ 20ìê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤')
    .regex(/^#/, 'íƒœê·¸ëª…ì€ #ìœ¼ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤')
    .regex(/^[#ê°€-í£a-zA-Z0-9]+$/, 'íƒœê·¸ëª…ì€ í•œê¸€, ì˜ë¬¸, ìˆ«ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤'),
  icon: z.string().optional(),
  description: z.string().max(100).optional()
});
```

**Delete Check:**
```typescript
async function deleteTag(tagId: string) {
  const tagWithCount = await prisma.tag.findUnique({
    where: { id: tagId },
    include: {
      _count: { select: { properties: true } }
    }
  });

  if (tagWithCount._count.properties > 0) {
    throw new Error(`${tagWithCount._count.properties}ê°œ ìˆ™ì†Œê°€ ì‚¬ìš©ì¤‘ì¸ íƒœê·¸ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤`);
  }

  await prisma.tag.delete({ where: { id: tagId } });
}
```

**Initial Tags (Seed Data):**
- #ë…¼ë·°ë§›ì§‘ ğŸŒ¾
- #ë¶ˆë©ê³¼ë³„ë© ğŸ”¥
- #ë°˜ë ¤ë™ë¬¼ë™ë°˜ ğŸ•
- #ì•„ê¶ì´ì²´í—˜ ğŸªµ
- #ê³„ê³¡ì• ğŸ’§
- #ì „í†µê°€ì˜¥ ğŸ 
- #ë†ì‚¬ì²´í—˜ ğŸŒ±
- #ëˆˆê½ƒì—¬í–‰ â„ï¸

**Korean Labels:** "íƒœê·¸ ê´€ë¦¬", "ìƒˆ íƒœê·¸ ì¶”ê°€", "íƒœê·¸ëª…", "ì‚¬ìš© ì¤‘ì¸ ìˆ™ì†Œ"

## Change Log
| Date | Version | Author |
|------|---------|--------|
| 2025-10-27 | 1.0 | John (PM) |

## Priority: P1 (High) | Story Points: 3 | Epic: Admin Features
