# Story 3.5: Media Upload (Photos and Videos)

## Status
Ready for Implementation

## Story
**As a** host registering or editing a property,
**I want** to upload high-quality photos and videos of my property,
**so that** I can showcase the unique atmosphere and attract more guests.

## Acceptance Criteria
1. Support image upload: JPG, PNG formats, max 5MB per file
2. Support video upload: MP4 format, max 50MB, max 1 minute duration
3. Minimum 3 images required, maximum 20 images allowed
4. Maximum 3 videos allowed (optional)
5. Drag-and-drop interface for file selection
6. Drag-and-drop reordering of uploaded images
7. Image preview with thumbnail generation
8. Video thumbnail auto-generated from first frame
9. Progress indicator during upload
10. Ability to delete uploaded files before submission
11. Files are uploaded to cloud storage (Vercel Blob or Cloudinary)
12. File URLs are stored in property.images array and property.videos array
13. Image optimization: automatic WebP conversion and responsive sizes
14. All UI text and error messages in Korean

## Tasks / Subtasks

- [ ] **Task 1**: Setup cloud storage integration (AC: 11)
  - [ ] Configure Vercel Blob or Cloudinary API keys
  - [ ] Create upload utility function in `src/lib/upload.ts`
  - [ ] Implement server-side upload endpoint
  - [ ] Handle file validation and security checks

- [ ] **Task 2**: Create ImageUploader component (AC: 1, 3, 5, 6, 7, 10)
  - [ ] Create `src/components/upload/image-uploader.tsx`
  - [ ] Implement drag-and-drop zone using react-dropzone
  - [ ] Validate file type (JPG, PNG) and size (max 5MB)
  - [ ] Display image previews in grid
  - [ ] Implement drag-and-drop reordering using dnd-kit
  - [ ] Add delete button for each image
  - [ ] Enforce min 3, max 20 image limit
  - [ ] Show validation errors in Korean

- [ ] **Task 3**: Create VideoUploader component (AC: 2, 4, 8)
  - [ ] Create `src/components/upload/video-uploader.tsx`
  - [ ] Validate file type (MP4), size (max 50MB), duration (max 60s)
  - [ ] Generate video thumbnail from first frame
  - [ ] Display video previews with play button
  - [ ] Limit to 3 videos max
  - [ ] Add delete functionality

- [ ] **Task 4**: Implement upload progress and optimization (AC: 9, 13)
  - [ ] Show upload progress bar for each file
  - [ ] Implement client-side image compression before upload
  - [ ] Auto-convert images to WebP on server
  - [ ] Generate responsive image sizes (thumbnail, medium, large)
  - [ ] Handle upload failures with retry option

- [ ] **Task 5**: Integration with property form (AC: 12)
  - [ ] Integrate ImageUploader in Step 3 of property registration
  - [ ] Store uploaded file URLs in form state
  - [ ] Pass URLs to property creation/update API
  - [ ] Save URLs in database: property.images (JSON array)
  - [ ] Handle cleanup of unused files

- [ ] **Task 6**: Testing (AC: 14)
  - [ ] Test file type validation
  - [ ] Test file size validation
  - [ ] Test drag-and-drop functionality
  - [ ] Test image reordering
  - [ ] Test video duration validation
  - [ ] Test upload progress and error handling
  - [ ] Verify responsive layout on mobile
  - [ ] Verify Korean error messages

## Dev Notes

### File Validation
```typescript
const imageSchema = z.object({
  type: z.enum(['image/jpeg', 'image/png']),
  size: z.number().max(5 * 1024 * 1024), // 5MB
});

const videoSchema = z.object({
  type: z.literal('video/mp4'),
  size: z.number().max(50 * 1024 * 1024), // 50MB
  duration: z.number().max(60), // 60 seconds
});
```

### Upload Flow
1. Client selects files
2. Client-side validation
3. Upload to Vercel Blob via Server Action
4. Server returns public URLs
5. URLs stored in form state
6. On form submit, URLs saved to database

### Korean Messages
- "사진을 드래그하거나 클릭하여 업로드하세요"
- "최소 3장, 최대 20장까지 업로드 가능합니다"
- "파일 크기는 5MB 이하여야 합니다"
- "지원하지 않는 파일 형식입니다"
- "업로드 중..." "업로드 완료"

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-27 | 1.0 | Initial story for media upload | John (PM) |

## Priority
P0

## Story Points
8

## Epic
Epic 3: Host and Property Management
